name: Deploy Self-Hosted

on:
Â  push:
Â  Â  branches: [ "main" ]

jobs:
Â  deploy:
Â  Â  runs-on: self-hostedÂ  # ğŸ‘ˆ à¸ˆà¸¸à¸”à¸ªà¸³à¸„à¸±à¸: à¸šà¸­à¸à¹ƒà¸«à¹‰à¸¡à¸²à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸£à¸²à¹€à¸­à¸‡

Â  Â  steps:
Â  Â  Â  - name: Checkout code
Â  Â  Â  Â  uses: actions/checkout@v4

Â  Â  Â  - name: Deploy with Docker
Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  TARGET_DIR="/var/www/html/smart-paddy"
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  echo "ğŸš€ Copying files to $TARGET_DIR..."
Â  Â  Â  Â  Â  mkdir -p $TARGET_DIR
Â  Â  Â  Â  Â  # à¹ƒà¸Šà¹‰ rsync à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¸ˆà¸²à¸à¸ˆà¸¸à¸”à¸—à¸µà¹ˆ Runner à¸­à¸¢à¸¹à¹ˆ à¹„à¸›à¸—à¸µà¹ˆà¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¸›à¸¥à¸²à¸¢à¸—à¸²à¸‡
Â  Â  Â  Â  Â  rsync -avz --exclude '.git' --exclude 'node_modules' --exclude '.next' ./ $TARGET_DIR

Â  Â  Â  Â  Â  # à¹€à¸‚à¹‰à¸²à¹„à¸›à¸ªà¸±à¹ˆà¸‡ Docker
Â  Â  Â  Â  Â  echo "ğŸ³ Building Docker..."
Â  Â  Â  Â  Â  cd $TARGET_DIR/web
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  # à¸–à¹‰à¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ .env à¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸£à¸‡à¸™à¸µà¹‰ (à¸«à¸£à¸·à¸­à¸ªà¸£à¹‰à¸²à¸‡à¸—à¸´à¹‰à¸‡à¹„à¸§à¹‰à¹ƒà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹à¸¥à¹‰à¸§à¸à¹‡à¹„à¸”à¹‰)
Â  Â  Â  Â  Â  # echo "DATABASE_URL=..." > .envÂ 

Â  Â  Â  Â  Â  docker compose down
Â  Â  Â  Â  Â  docker compose up -d --build
Â  Â  Â  Â  Â  docker image prune -f
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  echo "âœ… Deployment Successful!"  à¹€à¹€à¸à¹‰à¹„à¸‚
