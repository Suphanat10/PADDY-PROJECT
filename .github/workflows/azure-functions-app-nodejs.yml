- name: Deploy with Docker
        run: |
          TARGET_DIR="/var/www/html/smart-paddy"
          echo "üöÄ Copying files to $TARGET_DIR..."
          mkdir -p $TARGET_DIR
          
          # 1. ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å Runner ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
          rsync -avz --exclude '.git' --exclude 'node_modules' --exclude '.next' ./ $TARGET_DIR

          # 2. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå web (‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ docker-compose.yml ‡πÅ‡∏•‡∏∞ Dockerfile)
          cd $TARGET_DIR/web

          # 3. üî• ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .env ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå web ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Docker Compose ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô
          echo "NEXT_PUBLIC_API_BASE=${{ secrets.NEXT_PUBLIC_API_BASE }}" > .env
          echo "NEXT_PUBLIC_LIFF_ID=${{ secrets.NEXT_PUBLIC_LIFF_ID }}" >> .env
          echo "NEXT_PUBLIC_API_URL=${{ secrets.NEXT_PUBLIC_API_URL }}" >> .env
          
          # ‡πÄ‡∏û‡∏¥‡πà‡∏° DATABASE_URL (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏£‡∏∑‡∏≠ API ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ)
          # echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> .env

          # 4. üê≥ ‡∏™‡∏±‡πà‡∏á Docker ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
          echo "üê≥ Building Docker..."
          docker compose down
          # ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ Secrets ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô Build Args ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Next.js ‡∏ù‡∏±‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ô Build
          NEXT_PUBLIC_API_BASE=${{ secrets.NEXT_PUBLIC_API_BASE }} \
          NEXT_PUBLIC_LIFF_ID=${{ secrets.NEXT_PUBLIC_LIFF_ID }} \
          NEXT_PUBLIC_API_URL=${{ secrets.NEXT_PUBLIC_API_URL }} \
          docker compose up -d --build
          
          docker image prune -f
          echo "‚úÖ Deployment Successful!"
